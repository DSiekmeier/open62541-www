

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Adding a server-side method &mdash; open62541 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="open62541 1 documentation" href="index.html"/>
        <link rel="up" title="Tutorials" href="tutorials.html"/>
        <link rel="next" title="4. Generating an OPC UA Information Model from XML Descriptions" href="tutorial_noderelations.html"/>
        <link rel="prev" title="2. Adding variables to a server" href="tutorial_server_variables.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> open62541
          

          
            
            <img src="_static/open62541_html.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="in_a_nutshell.html">Introduction to OPC UA</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building open62541</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_firstSteps.html">1. Building a simple server</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_variables.html">2. Adding variables to a server</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3. Adding a server-side method</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_noderelations.html">4. Generating an OPC UA Information Model from XML Descriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_client_firstSteps.html">5. Building a simple client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="constants.html">Standard-Defined Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="internal.html">Internals</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">open62541</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
      
    <li>3. Adding a server-side method</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/tutorial_server_method.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-a-server-side-method">
<h1>3. Adding a server-side method<a class="headerlink" href="#adding-a-server-side-method" title="Permalink to this headline">Â¶</a></h1>
<p>This tutorial demonstrates how to add method nodes to the server. Use an UA
client, e.g., UaExpert to call the method (right-click on the method node -&gt;
call).</p>
<p>The first example shows how to define input and output arguments (lines 72 - 88),
make the method executable (lines 94,95), add the method node (line 96-101)
with a specified method callback (lines 10 - 24).</p>
<p>The second example shows that a method can also be applied on an array
as input argument and output argument.</p>
<p>The last example presents a way to bind a new method callback to an already
instantiated method node.</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;signal.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;open62541.h&quot;</span><span class="cp"></span>

<span class="n">UA_Boolean</span> <span class="n">running</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">UA_Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">UA_Log_Stdout</span><span class="p">;</span>


<span class="cm">/* Example 1 */</span>
<span class="k">static</span> <span class="n">UA_StatusCode</span>
<span class="nf">helloWorldMethod</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">handle</span><span class="p">,</span> <span class="k">const</span> <span class="n">UA_NodeId</span> <span class="n">objectId</span><span class="p">,</span>
                 <span class="kt">size_t</span> <span class="n">inputSize</span><span class="p">,</span> <span class="k">const</span> <span class="n">UA_Variant</span> <span class="o">*</span><span class="n">input</span><span class="p">,</span>
                 <span class="kt">size_t</span> <span class="n">outputSize</span><span class="p">,</span> <span class="n">UA_Variant</span> <span class="o">*</span><span class="n">output</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UA_String</span> <span class="o">*</span><span class="n">inputStr</span> <span class="o">=</span> <span class="p">(</span><span class="n">UA_String</span><span class="o">*</span><span class="p">)</span><span class="n">input</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
    <span class="n">UA_String</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">UA_STRING_ALLOC</span><span class="p">(</span><span class="s">&quot;Hello &quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">inputStr</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">realloc</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">tmp</span><span class="p">.</span><span class="n">length</span> <span class="o">+</span> <span class="n">inputStr</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">);</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">tmp</span><span class="p">.</span><span class="n">length</span><span class="p">],</span> <span class="n">inputStr</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">inputStr</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">);</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">length</span> <span class="o">+=</span> <span class="n">inputStr</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">UA_Variant_setScalarCopy</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_STRING</span><span class="p">]);</span>
    <span class="n">UA_String_deleteMembers</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
    <span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">UA_LOGCATEGORY_SERVER</span><span class="p">,</span> <span class="s">&quot;Hello World was called&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Example 2 */</span>
<span class="k">static</span> <span class="n">UA_StatusCode</span>
<span class="nf">IncInt32ArrayValuesMethod</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">handle</span><span class="p">,</span> <span class="k">const</span> <span class="n">UA_NodeId</span> <span class="n">objectId</span><span class="p">,</span>
                          <span class="kt">size_t</span> <span class="n">inputSize</span><span class="p">,</span> <span class="k">const</span> <span class="n">UA_Variant</span> <span class="o">*</span><span class="n">input</span><span class="p">,</span>
                          <span class="kt">size_t</span> <span class="n">outputSize</span><span class="p">,</span> <span class="n">UA_Variant</span> <span class="o">*</span><span class="n">output</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UA_Variant_setArrayCopy</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">input</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_INT32</span><span class="p">]);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">input</span><span class="o">-&gt;</span><span class="n">arrayLength</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">((</span><span class="n">UA_Int32</span><span class="o">*</span><span class="p">)</span><span class="n">output</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">UA_Int32</span><span class="o">*</span><span class="p">)</span><span class="n">input</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Example 3 */</span>
<span class="k">static</span> <span class="n">UA_StatusCode</span>
<span class="nf">fooBarMethod</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">handle</span><span class="p">,</span> <span class="k">const</span> <span class="n">UA_NodeId</span> <span class="n">objectId</span><span class="p">,</span>
             <span class="kt">size_t</span> <span class="n">inputSize</span><span class="p">,</span> <span class="k">const</span> <span class="n">UA_Variant</span> <span class="o">*</span><span class="n">input</span><span class="p">,</span>
             <span class="kt">size_t</span> <span class="n">outputSize</span><span class="p">,</span> <span class="n">UA_Variant</span> <span class="o">*</span><span class="n">output</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* the same as helloWorld, but returns foobar */</span>
    <span class="n">UA_String</span> <span class="o">*</span><span class="n">inputStr</span> <span class="o">=</span> <span class="p">(</span><span class="n">UA_String</span><span class="o">*</span><span class="p">)</span><span class="n">input</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
    <span class="n">UA_String</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">UA_STRING_ALLOC</span><span class="p">(</span><span class="s">&quot;FooBar! &quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">inputStr</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">realloc</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">tmp</span><span class="p">.</span><span class="n">length</span> <span class="o">+</span> <span class="n">inputStr</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">);</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">tmp</span><span class="p">.</span><span class="n">length</span><span class="p">],</span> <span class="n">inputStr</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">inputStr</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">);</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">length</span> <span class="o">+=</span> <span class="n">inputStr</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">UA_Variant_setScalarCopy</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_STRING</span><span class="p">]);</span>
    <span class="n">UA_String_deleteMembers</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
    <span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">UA_LOGCATEGORY_SERVER</span><span class="p">,</span> <span class="s">&quot;FooBar was called&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">stopHandler</span><span class="p">(</span><span class="kt">int</span> <span class="n">sign</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">UA_LOGCATEGORY_SERVER</span><span class="p">,</span> <span class="s">&quot;received ctrl-c&quot;</span><span class="p">);</span>
    <span class="n">running</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">stopHandler</span><span class="p">);</span> <span class="cm">/* catches ctrl-c */</span>

    <span class="cm">/* initialize the server */</span>
    <span class="n">UA_ServerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="n">UA_ServerConfig_standard</span><span class="p">;</span>
    <span class="n">UA_ServerNetworkLayer</span> <span class="n">nl</span><span class="p">;</span>
    <span class="n">nl</span> <span class="o">=</span> <span class="n">UA_ServerNetworkLayerTCP</span><span class="p">(</span><span class="n">UA_ConnectionConfig_standard</span><span class="p">,</span> <span class="mi">16664</span><span class="p">);</span>
    <span class="n">config</span><span class="p">.</span><span class="n">networkLayers</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">;</span>
    <span class="n">config</span><span class="p">.</span><span class="n">networkLayersSize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">UA_Server</span> <span class="o">*</span><span class="n">server</span> <span class="o">=</span> <span class="n">UA_Server_new</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>

    <span class="cm">/* Example 1 */</span>
    <span class="cm">/* add the method node with the callback */</span>
    <span class="n">UA_Argument</span> <span class="n">inputArguments1</span><span class="p">;</span>
    <span class="n">UA_Argument_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">inputArguments1</span><span class="p">);</span>
    <span class="n">inputArguments1</span><span class="p">.</span><span class="n">arrayDimensionsSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">inputArguments1</span><span class="p">.</span><span class="n">arrayDimensions</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">inputArguments1</span><span class="p">.</span><span class="n">dataType</span> <span class="o">=</span> <span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_STRING</span><span class="p">].</span><span class="n">typeId</span><span class="p">;</span>
    <span class="n">inputArguments1</span><span class="p">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;A String&quot;</span><span class="p">);</span>
    <span class="n">inputArguments1</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;MyInput&quot;</span><span class="p">);</span>
    <span class="n">inputArguments1</span><span class="p">.</span><span class="n">valueRank</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="n">UA_Argument</span> <span class="n">outputArguments1</span><span class="p">;</span>
    <span class="n">UA_Argument_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outputArguments1</span><span class="p">);</span>
    <span class="n">outputArguments1</span><span class="p">.</span><span class="n">arrayDimensionsSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">outputArguments1</span><span class="p">.</span><span class="n">arrayDimensions</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">outputArguments1</span><span class="p">.</span><span class="n">dataType</span> <span class="o">=</span> <span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_STRING</span><span class="p">].</span><span class="n">typeId</span><span class="p">;</span>
    <span class="n">outputArguments1</span><span class="p">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;A String&quot;</span><span class="p">);</span>
    <span class="n">outputArguments1</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;MyOutput&quot;</span><span class="p">);</span>
    <span class="n">outputArguments1</span><span class="p">.</span><span class="n">valueRank</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="n">UA_MethodAttributes</span> <span class="n">helloAttr</span><span class="p">;</span>
    <span class="n">UA_MethodAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">helloAttr</span><span class="p">);</span>
    <span class="n">helloAttr</span><span class="p">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span><span class="s">&quot;Say `Hello World`&quot;</span><span class="p">);</span>
    <span class="n">helloAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span><span class="s">&quot;Hello World&quot;</span><span class="p">);</span>
    <span class="n">helloAttr</span><span class="p">.</span><span class="n">executable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">helloAttr</span><span class="p">.</span><span class="n">userExecutable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">UA_Server_addMethodNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">62541</span><span class="p">),</span>
                            <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_OBJECTSFOLDER</span><span class="p">),</span>
                            <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASORDEREDCOMPONENT</span><span class="p">),</span>
                            <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;hello world&quot;</span><span class="p">),</span>
                            <span class="n">helloAttr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">helloWorldMethod</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                            <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">inputArguments1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">outputArguments1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="cm">/* Example 2 */</span>
    <span class="cm">/* add another method node: output argument as 1d Int32 array*/</span>
    <span class="n">UA_Argument</span> <span class="n">inputArguments2</span><span class="p">;</span>
    <span class="n">UA_Argument_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">inputArguments2</span><span class="p">);</span>
    <span class="n">inputArguments2</span><span class="p">.</span><span class="n">arrayDimensionsSize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">UA_UInt32</span> <span class="o">*</span> <span class="n">pInputDimensions</span> <span class="o">=</span> <span class="n">UA_UInt32_new</span><span class="p">();</span>
    <span class="n">pInputDimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">inputArguments2</span><span class="p">.</span><span class="n">arrayDimensions</span> <span class="o">=</span> <span class="n">pInputDimensions</span><span class="p">;</span>
    <span class="n">inputArguments2</span><span class="p">.</span><span class="n">dataType</span> <span class="o">=</span> <span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_INT32</span><span class="p">].</span><span class="n">typeId</span><span class="p">;</span>
    <span class="n">inputArguments2</span><span class="p">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span>
                    <span class="s">&quot;input an array with 5 elements, type int32&quot;</span><span class="p">);</span>
    <span class="n">inputArguments2</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;int32 value&quot;</span><span class="p">);</span>
    <span class="n">inputArguments2</span><span class="p">.</span><span class="n">valueRank</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">UA_Argument</span> <span class="n">outputArguments2</span><span class="p">;</span>
    <span class="n">UA_Argument_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outputArguments2</span><span class="p">);</span>
    <span class="n">outputArguments2</span><span class="p">.</span><span class="n">arrayDimensionsSize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">UA_UInt32</span> <span class="o">*</span> <span class="n">pOutputDimensions</span> <span class="o">=</span> <span class="n">UA_UInt32_new</span><span class="p">();</span>
    <span class="n">pOutputDimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">outputArguments2</span><span class="p">.</span><span class="n">arrayDimensions</span> <span class="o">=</span> <span class="n">pOutputDimensions</span><span class="p">;</span>
    <span class="n">outputArguments2</span><span class="p">.</span><span class="n">dataType</span> <span class="o">=</span> <span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_INT32</span><span class="p">].</span><span class="n">typeId</span><span class="p">;</span>
    <span class="n">outputArguments2</span><span class="p">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span>
                                                    <span class="s">&quot;increment each array index&quot;</span><span class="p">);</span>
    <span class="n">outputArguments2</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;output is the array, &quot;</span>
                                      <span class="s">&quot;each index is incremented by one&quot;</span><span class="p">);</span>
    <span class="n">outputArguments2</span><span class="p">.</span><span class="n">valueRank</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">UA_MethodAttributes</span> <span class="n">incAttr</span><span class="p">;</span>
    <span class="n">UA_MethodAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">incAttr</span><span class="p">);</span>
    <span class="n">incAttr</span><span class="p">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;1dArrayExample&quot;</span><span class="p">);</span>
    <span class="n">incAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;1dArrayExample&quot;</span><span class="p">);</span>
    <span class="n">incAttr</span><span class="p">.</span><span class="n">executable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">incAttr</span><span class="p">.</span><span class="n">userExecutable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">UA_Server_addMethodNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_STRING</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;IncInt32ArrayValues&quot;</span><span class="p">),</span>
                            <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_OBJECTSFOLDER</span><span class="p">),</span>
                            <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
                            <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;IncInt32ArrayValues&quot;</span><span class="p">),</span>
                            <span class="n">incAttr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">IncInt32ArrayValuesMethod</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                            <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">inputArguments2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">outputArguments2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="cm">/* Example 3 */</span>
    <span class="n">UA_MethodAttributes</span> <span class="n">method3Attr</span><span class="p">;</span>
    <span class="n">UA_MethodAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">method3Attr</span><span class="p">);</span>
    <span class="n">method3Attr</span><span class="p">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;FooBar&quot;</span><span class="p">);</span>
    <span class="n">method3Attr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;FooBar&quot;</span><span class="p">);</span>
    <span class="n">method3Attr</span><span class="p">.</span><span class="n">executable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">method3Attr</span><span class="p">.</span><span class="n">userExecutable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">UA_Server_addMethodNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_STRING</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;FooBar&quot;</span><span class="p">),</span>
                            <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_OBJECTSFOLDER</span><span class="p">),</span>
                            <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
                            <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;FooBar&quot;</span><span class="p">),</span>
                            <span class="n">method3Attr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                            <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">inputArguments1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">outputArguments1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="cm">/* If the method node has no callback (because it was instantiated without</span>
<span class="cm">     * one) or if we just want to change it, this can be done</span>
<span class="cm">     * UA_Server_setMethodNode_callback() */</span>
    <span class="n">UA_Server_setMethodNode_callback</span><span class="p">(</span><span class="n">server</span><span class="p">,</span>  <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">62542</span><span class="p">),</span>
                                     <span class="o">&amp;</span><span class="n">fooBarMethod</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="cm">/* start server */</span>
    <span class="n">UA_StatusCode</span> <span class="n">retval</span> <span class="o">=</span> <span class="n">UA_Server_run</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">running</span><span class="p">);</span>

    <span class="cm">/* ctrl-c received -&gt; clean up */</span>
    <span class="n">UA_UInt32_delete</span><span class="p">(</span><span class="n">pInputDimensions</span><span class="p">);</span>
    <span class="n">UA_UInt32_delete</span><span class="p">(</span><span class="n">pOutputDimensions</span><span class="p">);</span>
    <span class="n">UA_Server_delete</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
    <span class="n">nl</span><span class="p">.</span><span class="n">deleteMembers</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nl</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial_noderelations.html" class="btn btn-neutral float-right" title="4. Generating an OPC UA Information Model from XML Descriptions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial_server_variables.html" class="btn btn-neutral" title="2. Adding variables to a server" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, The open62541 authors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>